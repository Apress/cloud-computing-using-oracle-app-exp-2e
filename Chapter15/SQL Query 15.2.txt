SELECT TM.TRAN_NO, TM.VCHDATE, VCH.VCHTYPE, TM.VCHNO, TD.COACODE, COA.COATITLE, TM.VCHDESCRIPTION MD, TD.VCHDESCRIPTION DD, TD.VCHDR, TD.VCHCR, TD.VCHREFERENCE 
FROM  GL_COA COA, GL_VOUCHER VCH, GL_TRAN_MASTER TM, GL_TRAN_DETAIL TD 
WHERE TM.COCODE=TD.COCODE AND 
      TM.COCODE=COA.COCODE AND
      TM.TRAN_NO=TD.TRAN_NO AND 
      TM.VCHCODE=VCH.VCHCODE AND 
      TD.COACODE=COA.COACODE AND 
      TM.COCODE=(select cocode from gl_users where upper(userid)=upper(:APP_USER)) AND ( decode(:P53_CRITERION,'TD.COACODE',TD.COACODE)=:P53_SEARCH or decode(:P53_CRITERION,'COA.COATITLE',upper(COA.COATITLE)) Like upper(:P53_SEARCH) or decode(:P53_CRITERION,'TD.VCHCR',TD.VCHCR)=:P53_SEARCH or decode(:P53_CRITERION,'TD.VCHDR',TD.VCHDR)=:P53_SEARCH or 
decode(:P53_CRITERION,'TD.VCHDESCRIPTION',upper(TD.VCHDESCRIPTION)) Like upper(:P53_SEARCH) or
decode(:P53_CRITERION,'TM.VCHDESCRIPTION',upper(TM.VCHDESCRIPTION)) Like upper(:P53_SEARCH) or decode(:P53_CRITERION,'TD.VCHREFERENCE',upper(TD.VCHREFERENCE)) Like upper(:P53_SEARCH) or decode(:P53_CRITERION,'TM.VCHNO',TM.VCHNO)=:P53_SEARCH 
)
ORDER BY TM.VCHDATE